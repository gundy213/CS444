<!DOCTYPE HTML>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>WSU Arboretum</title>
        <link rel="icon" type="image/x-icon" href="https://www.winona.edu/favicon.png">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link href="css/skipToLink.css" rel="stylesheet">
        <script>
            // This is an array containing the paths to all the 
            // images we have used for cards so far
            // we need this so we can prevent duplicate
            // images from being used on our cards
            const entityImagesUsed = [];
            
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    getInfo(this);
                }
            };
            xhttp.open("GET", "themes.xml", true);
            xhttp.send();
            
            // toursXML is the response from an XML request for the themes.xml
            // This function calls the getXMLForTheme function for each
            // ThemeData in the themes.xml
            function getInfo(toursXML) {
                var tours, xmlDoc;
                xmlDoc = toursXML.responseXML;
                tours = xmlDoc.getElementsByTagName("ThemeData");
                for (i = 0; i < tours.length; i++) {
                    var themeName = tours[i].childNodes[3].innerHTML;
                    var themeDescription = tours[i].childNodes[0].innerHTML;
                    var themeId = tours[i].childNodes[2].innerHTML;
            
                    createCard(themeName, themeDescription, themeId);
            
                    getXMLForTheme(themeName, themeDescription, themeId);
                }
            };
            
            // This function makes a XMLHttpRequest to load in
            // the xml for a specific theme
            function getXMLForTheme(themeName, themeDescription, themeId)
            {
                // make xml request to get the theme data
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        getImageFromXML(this, themeId);
                    }
                };
                
                xhttp.open("GET", "xmlForEachTheme/" + themeId +  ".xml", true);
                xhttp.send(); 
            }
            
            // Uses the xml file for the specific theme to find an image for the card
            // then populates the image based on the image-[themeId] id attribute
            // added to each cards image
            function getImageFromXML(themeXML, themeId)
            {
                var entities, xmlDoc;
                xmlDoc = themeXML.responseXML;
                entities = xmlDoc.getElementsByTagName("ThemeEntityAbridgedData");
                for (i = 0; i < entities.length; i++) {
                    var imagePath = entities[i].childNodes[0].innerHTML;
                    // Check to see if the imagePath is not empty
                    // if it is empty we will try the next entity
                    if ((imagePath || imagePath.trim()) && (entityImagesUsed.indexOf(imagePath) >= 0) == false){
                        var image = document.getElementById("image-"+themeId);
                        image.setAttribute('src', imagePath);
                        entityImagesUsed.push(imagePath);
                        break; // we only want one card per theme
                    }
                }
            }
            
            //dynamically create cards
            function createCard(tourName, tourDescription, tourId) {
               
                let col = document.createElement('div');
            
                let img = document.createElement('img');
                img.className = 'card-img-top';
                img.setAttribute("id", "image-"+tourId)
                img.setAttribute('style', 'aspect-ratio: 4/3; object-fit: cover;')
                //will need to be set to some relevant tree in the theme
                img.setAttribute('src', 'https://previews.123rf.com/images/olegd/olegd1108/olegd110800153/10298561-close-up-of-coconut-palm-tree.jpg');
                
                let card = document.createElement('div');
                card.className = 'card h-100 shadow-sm';
            
                let cardBody = document.createElement('div');
                cardBody.className = 'card-body';
            
                let title = document.createElement('h4');
                title.className = 'text-center';
                title.innerText = tourName;
            
                //theme description
                let description = document.createElement('p');
                description.className = '';
                description.innerText = tourDescription;
            
                let cardFooter = document.createElement('div');
                cardFooter.className = 'card-footer text-center';
                cardFooter.setAttribute('style', 'background-color: #3B1183;')
            
                //needs link to theme map
                let map = document.createElement('a');
                map.className = 'btn float-start btn-light';
                map.setAttribute('href', '');
                map.innerText = 'Map';
            
                //needs link to theme directory
                let directory = document.createElement('a');
                directory.className = 'btn float-end btn-light';
                directory.setAttribute('href', '');
                directory.innerText = 'Directory';
            
                //build card
                cardBody.appendChild(title);
                cardBody.appendChild(description);
                card.appendChild(img);
                card.appendChild(cardBody);
                cardFooter.appendChild(map);
                cardFooter.appendChild(directory);
                card.appendChild(cardFooter)
                col.appendChild(card);
                cardContainer.appendChild(col);
            };
            
            
        </script>
    </head>
    <body style="background-color: #D9D5D1;">

        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-dark py-2 fixed-top" style="background-color:#3B1183">
            <div class="container-fluid">
                <a id="pageLabel" class="navbar-brand ">WSU Arboretum</a>
                <a class="skip" href='#content'>Skip to content</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu">
                <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navmenu">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a href="" class="nav-link">Winona State University</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Navbar -->
        <div id="invisible" class="container rounded p-2 my-2">
        </div>

        <!-- Main -->
        <div class="container-lg mt-5">
            <div id="cardContainer" class="row row-cols-1 row-cols-xs-1 row-cols-md-1 row-cols-lg-2 row-cols-xl-3 g-3 ">
            </div>
        </div>
        <!-- Main -->

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    </body>
</html>